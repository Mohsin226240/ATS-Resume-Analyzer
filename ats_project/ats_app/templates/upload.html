<!DOCTYPE html>
<html>
<head>
    <title>ATS Upload</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body class="container mt-5">
    <h2>Upload CV(s)</h2>
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        {{ form.as_p }}
        <button class="btn btn-primary">Analyze</button>
    </form>

{% if results %}
<hr>
<h3>Analysis Results</h3>
<table class="table table-bordered">
    <thead>
    <tr>
        <th>Filename</th>
        <th>Match Score</th>
        <th>Matched Keywords</th>
        <th>Preview</th>
        <th>Professionalism Score</th>
        <th>Certifications</th>
        <th>Suggestions</th>
        <th>Download Report</th>
    </tr>
    </thead>
    <tbody>
        {% for res in results %}
        <tr>
            <td>{{ res.filename }}</td>
            <td>{{ res.score }}%</td>
            <td>
                {% for word in res.keywords %}
                    <span class="badge bg-success">{{ word }}</span>
                {% endfor %}
            </td>
            <td><pre>{{ res.text }}</pre></td>
            <td>{{ res.professionalism_score }}</td>
            <td>
                {% if res.certifications %}
                    {% for cert in res.certifications %}
                        <div>{{ cert }}</div>
                    {% endfor %}
                {% else %}
                    N/A
                {% endif %}
            </td>
            <td>
                {% if res.suggestions %}
                    <ul>
                    {% for sug in res.suggestions %}
                        <li>{{ sug }}</li>
                    {% endfor %}
                    </ul>
                {% else %}
                    N/A
                {% endif %}
            </td>
            <td>
                <a href="{% url 'download_report' %}?filename={{ res.filename|urlencode }}&score={{ res.score }}&matched={{ res.keywords|join:','|urlencode }}&preview={{ res.text|urlencode }}" class="btn btn-sm btn-success" target="_blank">Download TXT</a>
                <a href="{% url 'download_pdf_report' %}?filename={{ res.filename|urlencode }}&score={{ res.score }}&matched={{ res.keywords|join:','|urlencode }}&preview={{ res.text|urlencode }}" class="btn btn-sm btn-primary" target="_blank">Download PDF</a>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endif %}

<form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    <input type="file" name="resumes" multiple required>  <!-- name should be 'files' -->
    <button type="submit" class="btn btn-primary">Analyze CV</button>
</form>
